{"_path":"/guide/usage/server-side","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Server side","description":"On the server side you can get access to the current session like this:","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"server-side-usage"},"children":[{"type":"text","value":"Server-side usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the server side you can get access to the current session like this:"}]},{"type":"element","tag":"code","props":{"code":"import { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is inspired by "},{"type":"element","tag":"a","props":{"href":"https://next-auth.js.org/tutorials/securing-pages-and-api-routes#securing-api-routes","rel":["nofollow"]},"children":[{"type":"text","value":"the getServerSession"}]},{"type":"text","value":" of NextAuth.js. It also avoids an external, internet call to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET /api/auth/sessions"}]},{"type":"text","value":" endpoint, instead directly calling a pure JS-method."}]},{"type":"element","tag":"h2","props":{"id":"server-side-endpoint-protection"},"children":[{"type":"text","value":"Server-side endpoint protection"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To protect an endpoint with, check the session after fetching it:"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/api/protected.get.ts\nimport { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n  if (!session) {\n    return { status: 'unauthenticated!' }\n  }\n  return { status: 'authenticated!' }\n})\n\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// file: ~/server/api/protected.get.ts\nimport { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n  if (!session) {\n    return { status: 'unauthenticated!' }\n  }\n  return { status: 'authenticated!' }\n})\n\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"server-side-middleware"},"children":[{"type":"text","value":"Server-side middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can also use this in a "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/guide/directory-structure/server#server-middleware","rel":["nofollow"]},"children":[{"type":"text","value":"Nuxt server middleware"}]},{"type":"text","value":" to protect multiple pages at once and keep the authentication logic out of your endpoints:"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/middleware/auth.ts\nimport { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n  if (!session) {\n    throw createError({ statusMessage: 'Unauthenticated', statusCode: 403 })\n  }\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// file: ~/server/middleware/auth.ts\nimport { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n  if (!session) {\n    throw createError({ statusMessage: 'Unauthenticated', statusCode: 403 })\n  }\n})\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"getting-the-jwt-token"},"children":[{"type":"text","value":"Getting the JWT Token"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Getting the (decoded) JWT token of the current user can be helpful, e.g., to use it to access an external api that requires this token for authentication or authorization."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can get the JWT token that was passed along with the request using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"getToken"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/api/token.get.ts\nimport { getToken } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const token = await getToken({ event })\n\n  return token || 'no token present'\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// file: ~/server/api/token.get.ts\nimport { getToken } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const token = await getToken({ event })\n\n  return token || 'no token present'\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The function behaves identical to the "},{"type":"element","tag":"a","props":{"href":"https://next-auth.js.org/tutorials/securing-pages-and-api-routes#using-gettoken","rel":["nofollow"]},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"getToken"}]},{"type":"text","value":" function from NextAuth.js"}]},{"type":"text","value":" with one change: you have to pass in the h3-"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" instead of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"req"}]},{"type":"text","value":". This is due to how cookies can be accessed on h3: not via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"req.cookies"}]},{"type":"text","value":" but rather via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useCookies(event)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You do not need to pass in any further parameters like "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"secret"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"secureCookie"}]},{"type":"text","value":", ... They are automatically inferred to the values you configured if not set and reading the token will work out of the box. You "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"may"}]},{"type":"text","value":" pass these options, e.g., to get the raw, encoded JWT token you can pass "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"raw: true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"application-side-jwt-token-access"},"children":[{"type":"text","value":"Application-side JWT token access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To access the JWT token application-side, e.g., in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" page, you can create an endpoint like this:"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/api/token.get.ts\nimport { getToken } from '#auth'\n\nexport default eventHandler(event => getToken({ event }))\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// file: ~/server/api/token.get.ts\nimport { getToken } from '#auth'\n\nexport default eventHandler(event => getToken({ event }))\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then from your application-side code you can fetch it like this:"}]},{"type":"element","tag":"code","props":{"code":"// file: app.vue\n<template>\n  <div>{{ token || 'no token present, are you logged in?' }}</div>\n</template>\n\n<script setup lang=\"ts\">\nconst headers = useRequestHeaders(['cookie'])\nconst { data: token } = await useFetch('/api/token', { headers: { cookie: headers.cookie } })\n</script>\n","language":"vue"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// file: app.vue\n<template>\n  <div>{{ token || 'no token present, are you logged in?' }}</div>\n</template>\n\n<script setup lang=\"ts\">\nconst headers = useRequestHeaders(['cookie'])\nconst { data: token } = await useFetch('/api/token', { headers: { cookie: headers.cookie } })\n</script>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that you have to pass the cookie-header manually. You also have to pass it using "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/api/composables/use-request-headers/","rel":["nofollow"]},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useRequestHeaders"}]}]},{"type":"text","value":" so that the cookies are also correctly passed when this page is rendered server-side during the "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/guide/concepts/rendering#universal-rendering","rel":["nofollow"]},"children":[{"type":"text","value":"universal-rendering process"}]},{"type":"text","value":"."}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"server-side-usage"},"children":[{"type":"text","value":"Server-side usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the server side you can get access to the current session like this:"}]},{"type":"element","tag":"code","props":{"code":"import { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"getServerSession"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'#auth'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"eventHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"session"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"getServerSession"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is inspired by "},{"type":"element","tag":"a","props":{"href":"https://next-auth.js.org/tutorials/securing-pages-and-api-routes#securing-api-routes","rel":["nofollow"]},"children":[{"type":"text","value":"the getServerSession"}]},{"type":"text","value":" of NextAuth.js. It also avoids an external, internet call to the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET /api/auth/sessions"}]},{"type":"text","value":" endpoint, instead directly calling a pure JS-method."}]},{"type":"element","tag":"h2","props":{"id":"server-side-endpoint-protection"},"children":[{"type":"text","value":"Server-side endpoint protection"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To protect an endpoint with, check the session after fetching it:"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/api/protected.get.ts\nimport { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n  if (!session) {\n    return { status: 'unauthenticated!' }\n  }\n  return { status: 'authenticated!' }\n})\n\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f9d00"},"children":[{"type":"text","value":"// file: ~/server/api/protected.get.ts"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"getServerSession"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'#auth'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"eventHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"session"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"getServerSession"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"session"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'unauthenticated!'"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'authenticated!'"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"server-side-middleware"},"children":[{"type":"text","value":"Server-side middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can also use this in a "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/guide/directory-structure/server#server-middleware","rel":["nofollow"]},"children":[{"type":"text","value":"Nuxt server middleware"}]},{"type":"text","value":" to protect multiple pages at once and keep the authentication logic out of your endpoints:"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/middleware/auth.ts\nimport { getServerSession } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const session = await getServerSession(event)\n  if (!session) {\n    throw createError({ statusMessage: 'Unauthenticated', statusCode: 403 })\n  }\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f9d00"},"children":[{"type":"text","value":"// file: ~/server/middleware/auth.ts"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"getServerSession"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'#auth'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"eventHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"session"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"getServerSession"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"session"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"throw"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"createError"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"({ "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"statusMessage"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'Unauthenticated'"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"statusCode"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0c8b64"},"children":[{"type":"text","value":"403"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" })"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"getting-the-jwt-token"},"children":[{"type":"text","value":"Getting the JWT Token"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Getting the (decoded) JWT token of the current user can be helpful, e.g., to use it to access an external api that requires this token for authentication or authorization."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can get the JWT token that was passed along with the request using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"getToken"}]},{"type":"text","value":":"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/api/token.get.ts\nimport { getToken } from '#auth'\n\nexport default eventHandler(async (event) => {\n  const token = await getToken({ event })\n\n  return token || 'no token present'\n})\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f9d00"},"children":[{"type":"text","value":"// file: ~/server/api/token.get.ts"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"getToken"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'#auth'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"eventHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"getToken"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"({ "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" })"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"||"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'no token present'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The function behaves identical to the "},{"type":"element","tag":"a","props":{"href":"https://next-auth.js.org/tutorials/securing-pages-and-api-routes#using-gettoken","rel":["nofollow"]},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"getToken"}]},{"type":"text","value":" function from NextAuth.js"}]},{"type":"text","value":" with one change: you have to pass in the h3-"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" instead of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"req"}]},{"type":"text","value":". This is due to how cookies can be accessed on h3: not via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"req.cookies"}]},{"type":"text","value":" but rather via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useCookies(event)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You do not need to pass in any further parameters like "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"secret"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"secureCookie"}]},{"type":"text","value":", ... They are automatically inferred to the values you configured if not set and reading the token will work out of the box. You "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"may"}]},{"type":"text","value":" pass these options, e.g., to get the raw, encoded JWT token you can pass "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"raw: true"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"application-side-jwt-token-access"},"children":[{"type":"text","value":"Application-side JWT token access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To access the JWT token application-side, e.g., in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" page, you can create an endpoint like this:"}]},{"type":"element","tag":"code","props":{"code":"// file: ~/server/api/token.get.ts\nimport { getToken } from '#auth'\n\nexport default eventHandler(event => getToken({ event }))\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5f9d00"},"children":[{"type":"text","value":"// file: ~/server/api/token.get.ts"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"getToken"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'#auth'"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"eventHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"getToken"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"({ "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" }))"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then from your application-side code you can fetch it like this:"}]},{"type":"element","tag":"code","props":{"code":"// file: app.vue\n<template>\n  <div>{{ token || 'no token present, are you logged in?' }}</div>\n</template>\n\n<script setup lang=\"ts\">\nconst headers = useRequestHeaders(['cookie'])\nconst { data: token } = await useFetch('/api/token', { headers: { cookie: headers.cookie } })\n</script>\n","language":"vue"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"// file: app.vue"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"class":"ct-0c8b64"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":">{{ "}]},{"type":"element","tag":"span","props":{"class":"ct-0c8b64"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" || "}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'no token present, are you logged in?'"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" }}</"}]},{"type":"element","tag":"span","props":{"class":"ct-0c8b64"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0c8b64"},"children":[{"type":"text","value":"setup"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0c8b64"},"children":[{"type":"text","value":"lang"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"\"ts\""}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"useRequestHeaders"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'cookie'"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"])"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-77b056"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-849a36"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-39c6d2"},"children":[{"type":"text","value":"useFetch"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-82da84"},"children":[{"type":"text","value":"'/api/token'"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":", { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"cookie"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2dd5c5"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"cookie"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":" } })"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-d4d8fc"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"class":"ct-4356fb"},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that you have to pass the cookie-header manually. You also have to pass it using "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/api/composables/use-request-headers/","rel":["nofollow"]},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useRequestHeaders"}]}]},{"type":"text","value":" so that the cookies are also correctly passed when this page is rendered server-side during the "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/guide/concepts/rendering#universal-rendering","rel":["nofollow"]},"children":[{"type":"text","value":"universal-rendering process"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-0c8b64{color:#D19A66}.ct-5f9d00{color:#7F848E}.ct-77b056{color:#56B6C2}.ct-2dd5c5{color:#E5C07B}.ct-39c6d2{color:#61AFEF}.ct-82da84{color:#98C379}.ct-d4d8fc{color:#E06C75}.ct-4356fb{color:#ABB2BF}.ct-849a36{color:#C678DD}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"server-side-endpoint-protection","depth":2,"text":"Server-side endpoint protection"},{"id":"server-side-middleware","depth":2,"text":"Server-side middleware"},{"id":"getting-the-jwt-token","depth":2,"text":"Getting the JWT Token","children":[{"id":"application-side-jwt-token-access","depth":3,"text":"Application-side JWT token access"}]}]}},"_type":"markdown","_id":"content:2.guide:4.usage:1.server-side.md","_source":"content","_file":"2.guide/4.usage/1.server-side.md","_extension":"md"}